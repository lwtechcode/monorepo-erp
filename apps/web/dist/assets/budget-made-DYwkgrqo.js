import{f as B,a as S,b as p,j as t,T as l,r as y,M as I,S as m,R as x,B as h,c as T,e as k,u as N,d as w,F as d,I as E,g as P,h as D}from"./index-DW3Sgpru.js";function b({handleFilterSalesMade:n}){const[s,r]=y.useState();function i(){n&&n(e=>({...e,status:s}))}function a(){n&&n(e=>({...e,status:void 0})),r(void 0)}return t.jsx(I,{children:t.jsxs(m,{className:"px-2 py-3",direction:"vertical",children:[t.jsx(x.Group,{value:s,onChange:e=>r(e.target.value),children:t.jsxs(m,{direction:"vertical",children:[t.jsx(x,{value:"ativo",children:"Ativo"}),t.jsx(x,{value:"inativo",children:"Inativo"})]})}),t.jsxs(m,{children:[t.jsx(h,{onClick:a,children:"Limpar"}),t.jsx(h,{type:"primary",onClick:i,children:"Aplicar"})]})]})})}function M({sales:n,handleFilterSalesMade:s}){const r=[{key:"name",title:"Nome",dataIndex:"name",sorter:(a,e)=>a.name.length-e.name.length,showSorterTooltip:{title:"Ordenar por nome"},ellipsis:!0},{key:"cpf",title:"CPF",dataIndex:"cpf",ellipsis:!0},{key:"created_at",title:"Data da venda",dataIndex:"created_at",ellipsis:!0},{key:"payment_name",title:"Pagamento",dataIndex:"payment_name",ellipsis:!0},{key:"tax_payment_value",title:"Acréscimos",dataIndex:"tax_payment_value",ellipsis:!0},{key:"status",title:"Status",dataIndex:"status",width:"10%",ellipsis:!0,filterMode:"menu",filterMultiple:!1,filterDropdown:b({handleFilterSalesMade:s}),filters:[{text:"Ativo",value:"ativo"},{text:"Inativo",value:"inativo"}]},{key:"discount_value",title:"Desconto",dataIndex:"discount_value",ellipsis:!0},{key:"total_value",title:"Total",dataIndex:"total_value",ellipsis:!0}],i=n==null?void 0:n.map((a,e)=>{var o,u;return{key:a.id,id:a.id,name:((o=a.client)==null?void 0:o.name)||"-",cpf:B((u=a.client)==null?void 0:u.cpf)||"-",payment_name:a.payment.name,created_at:S(a.created_at),tax_payment_value:p(a.tax_payment_value),total_value:p(a.total_value),discount_value:p(a.discount_value),status:a.active?t.jsx(l.Text,{type:"success",children:"Ativado"}):t.jsx(l.Text,{type:"danger",children:"Inativo"})}});return{columns:r,data:i}}async function L({status:n,orderBy:s,page:r=1,nameOrCPF:i,pageSize:a=10}){try{const e=await T.get("/sale-budgets",{params:{orderBy:s,nameOrCPF:i,page:r,pageSize:a,status:n}});return e==null?void 0:e.data}catch(e){throw new Error(await k(e))}}const O="vendas-realizadas";function R({debounceSearchTerm:n,filterSales:s,selectedPage:r}){const{data:i,isPending:a,refetch:e}=N({queryKey:[O,s.status,s.ordered,n,r],queryFn:()=>L({status:s.status,orderBy:s.ordered,nameOrCPF:n,page:r,pageSize:20})});return{salesMade:i,isFetchingSalesMade:a,refetchSalesMade:e}}function z(){var f,g;const[n,s]=y.useState({pagination:{current:1,pageSize:20}}),[r,i]=y.useState({textFilterByNameAndCpf:"",status:"",ordered:""}),a=w(r.textFilterByNameAndCpf),{salesMade:e,isFetchingSalesMade:o}=R({debounceSearchTerm:a,filterSales:r,selectedPage:(f=n==null?void 0:n.pagination)==null?void 0:f.current}),u=o;(g=e==null?void 0:e.salesBudgets)!=null&&g.length;function j(){return!!r.status}function v(){return!!r.ordered||!!r.textFilterByNameAndCpf}function _(){i({textFilterByNameAndCpf:"",status:"",ordered:""})}const{columns:C,data:F}=M({sales:e==null?void 0:e.salesBudgets});return t.jsxs(d,{className:"h-full",justify:"center",vertical:!0,children:[t.jsx(l.Title,{level:4,children:"Orçamentos"}),t.jsxs(d,{gap:12,children:[t.jsx(E,{placeholder:"Pesquise por nome ou CPF",onChange:({target:c})=>{i(A=>({...A,textFilterByNameAndCpf:c.value}))},value:r.textFilterByNameAndCpf,allowClear:!0}),j()||v()?t.jsxs(h,{onClick:_,type:"dashed",children:[t.jsx(P,{component:"ClearOutlined"}),v()?"Limpar":"Limpar filtros"]}):null]}),t.jsx(d,{className:"h-full",justify:"start",vertical:!0,rootClassName:"mt-4",children:t.jsx(D,{size:"small",columns:C,dataSource:F,loading:u,pagination:{...n.pagination,total:e==null?void 0:e.totalCount,showTotal:c=>t.jsxs(d,{gap:4,children:[t.jsx(l.Text,{className:"font-bold",children:"Total de Registros:"}),t.jsx(l.Text,{children:c||0})]})}})})]})}export{z as default};
