import{u as E,j as t,F as p,T as P,B as y,R,I as k,f as b,a as L,b as f,c as x,r as _,M as O,S as g,d as j,e as M,g as K,h as q,i as G,k as Q}from"./index-BPvzKghM.js";function V({handleFilterSalesMade:a}){const[i,n]=_.useState();function l(){a&&a(e=>({...e,status:i}))}function o(){a&&a(e=>({...e,status:void 0})),n(void 0)}return t.jsx(O,{children:t.jsxs(g,{className:"px-2 py-3",direction:"vertical",children:[t.jsx(j.Group,{value:i,onChange:e=>n(e.target.value),children:t.jsxs(g,{direction:"vertical",children:[t.jsx(j,{value:"ativo",children:"Ativo"}),t.jsx(j,{value:"inativo",children:"Inativo"})]})}),t.jsxs(g,{children:[t.jsx(y,{onClick:o,children:"Limpar"}),t.jsx(y,{type:"primary",onClick:l,children:"Aplicar"})]})]})})}function Y({sales:a,handleFilterSalesMade:i}){const n=E(),l=[{key:"name",title:"Nome",dataIndex:"name",sorter:(e,r)=>e.name.length-r.name.length,showSorterTooltip:{title:"Ordenar por nome"},ellipsis:!0},{key:"cpf",title:"CPF",dataIndex:"cpf",ellipsis:!0},{key:"created_at",title:"Data da venda",dataIndex:"created_at",ellipsis:!0},{key:"payment_name",title:"Pagamento",dataIndex:"payment_name",ellipsis:!0},{key:"tax_payment_value",title:"Acréscimos",dataIndex:"tax_payment_value",ellipsis:!0},{key:"status",title:"Status",dataIndex:"status",width:"10%",ellipsis:!0,filterMode:"menu",filterMultiple:!1,filterDropdown:V({handleFilterSalesMade:i}),filters:[{text:"Ativo",value:"ativo"},{text:"Inativo",value:"inativo"}]},{key:"discount_value",title:"Desconto",dataIndex:"discount_value",ellipsis:!0},{key:"total_value",title:"Total",dataIndex:"total_value",ellipsis:!0},{title:"Ações",dataIndex:"",key:"x",align:"center",render:(e,r)=>t.jsx(p,{align:"center",justify:"center",children:t.jsx(P,{title:"Finalizar venda",children:t.jsx(y,{type:"text",onClick:()=>{n(R.Sales,{state:{isBudget:!0,idBudget:r.id}})},children:t.jsx(k,{component:"DollarTwoTone"})})})}),width:"20%"}],o=a==null?void 0:a.map((e,r)=>{var d,m;return{key:e.id,id:e.id,name:((d=e.client)==null?void 0:d.name)||"-",cpf:b((m=e.client)==null?void 0:m.cpf)||"-",payment_name:e.payment.name,created_at:L(e.created_at),tax_payment_value:f(e.tax_payment_value),total_value:f(e.total_value),discount_value:f(e.discount_value),status:e.active?t.jsx(x.Text,{type:"success",children:"Ativado"}):t.jsx(x.Text,{type:"danger",children:"Inativo"})}});return{columns:l,data:o}}const H="vendas-realizadas";function U({debounceSearchTerm:a,filterSales:i,selectedPage:n}){const{isLoading:l,isFetching:o,isRefetching:e,data:r,refetch:d}=M({queryKey:[H,i.status,i.ordered,a,n],queryFn:()=>K({status:i.status,orderBy:i.ordered,nameOrCPF:a,page:n,pageSize:20})});return{salesMade:r,isFetchingSalesMade:e||o||l,refetchSalesMade:d}}function J(){var C,F;const[a,i]=_.useState({pagination:{current:1,pageSize:20}}),[n,l]=_.useState({textFilterByNameAndCpf:"",status:"",ordered:""}),o=q(n.textFilterByNameAndCpf),{salesMade:e,isFetchingSalesMade:r}=U({debounceSearchTerm:o,filterSales:n,selectedPage:(C=a==null?void 0:a.pagination)==null?void 0:C.current}),d=r;function m(u,v,s){var B,T,S;const w={descend:()=>h()},z={descend:()=>h()};if((B=s.columnKey)!=null&&B.includes("createdAt")){const c=w[s.order];c&&c()}if((T=s.columnKey)!=null&&T.includes("name")){const c=z[s.order];c&&c()}if(i({pagination:u,filters:v,sortOrder:Array.isArray(s)?void 0:s.order,sortField:Array.isArray(s)?void 0:s.field}),u.pageSize!==((S=a.pagination)==null?void 0:S.pageSize))return[]}(F=e==null?void 0:e.salesBudgets)!=null&&F.length;function I(){return!!n.status}function A(){return!!n.ordered||!!n.textFilterByNameAndCpf}function h(){l({textFilterByNameAndCpf:"",status:"",ordered:""})}const{columns:N,data:D}=Y({sales:e==null?void 0:e.salesBudgets});return t.jsxs(p,{className:"h-full",justify:"center",vertical:!0,children:[t.jsx(x.Title,{level:4,children:"Orçamentos"}),t.jsxs(p,{gap:12,children:[t.jsx(G,{placeholder:"Pesquise por nome ou CPF",onChange:({target:u})=>{l(v=>({...v,textFilterByNameAndCpf:u.value}))},value:n.textFilterByNameAndCpf,allowClear:!0}),I()||A()?t.jsxs(y,{onClick:h,type:"dashed",children:[t.jsx(k,{component:"ClearOutlined"}),A()?"Limpar":"Limpar filtros"]}):null]}),t.jsx(p,{className:"h-full",justify:"start",vertical:!0,rootClassName:"mt-4",children:t.jsx(Q,{size:"small",columns:N,dataSource:D,loading:d,onChange:m,pagination:{...a.pagination,total:e==null?void 0:e.totalCount,showTotal:u=>t.jsxs(p,{gap:4,children:[t.jsx(x.Text,{className:"font-bold",children:"Total de Registros:"}),t.jsx(x.Text,{children:u||0})]})}})})]})}export{J as default};
